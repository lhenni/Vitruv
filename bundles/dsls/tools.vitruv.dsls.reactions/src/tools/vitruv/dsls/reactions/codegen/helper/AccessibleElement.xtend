package tools.vitruv.dsls.reactions.codegen.helper

import java.util.List
import org.eclipse.xtend.lib.annotations.Accessors
import org.eclipse.xtext.xbase.jvmmodel.JvmTypeReferenceBuilder
import org.eclipse.xtext.common.types.JvmUnknownTypeReference
import tools.vitruv.dsls.reactions.codegen.typesbuilder.JvmTypesBuilderWithoutAssociations

class AccessibleElement {
	@Accessors(PUBLIC_GETTER)
	private val String name;
	private val String fullyQualifiedTypeName;
	private val List<String> typeParameters;
	
	public new(String name, String fullyQualifiedTypeName) {
		this.name = name;
		this.fullyQualifiedTypeName = fullyQualifiedTypeName;
		this.typeParameters = newArrayList
	}
	
	public new(String name, String fullyQualifiedTypeName, String... typeParameters) {
		this(name, fullyQualifiedTypeName);
		this.typeParameters += typeParameters;
	}
	
	public new(String name, Class<?> type) {
		this(name, type.name)
	}
	
	public def generateTypeRef(@Extension JvmTypeReferenceBuilder typeReferenceBuilder, @Extension JvmTypesBuilderWithoutAssociations typesBuilder) {
		typeRef(fullyQualifiedTypeName, typeParameters.map[
			var typeRef = typeRef(it)
			// TODO workaround for getting jvm type references generated by the Commonalities Language working in execution tests
			if (typeRef instanceof JvmUnknownTypeReference) {
				val jvmType = generateUnassociatedClass(typeRef.qualifiedName, null)
				typeRef = typeRef(jvmType)
			}
			typeRef
		])
	}
	
}